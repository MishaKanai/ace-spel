!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("TsSpel",[],e):"object"==typeof exports?exports.TsSpel=e():r.TsSpel=e()}(this,(()=>(()=>{"use strict";var r={543:function(r,e,n){var t,o=this&&this.__extends||(t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])},t(r,e)},function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.UnexpectedError=e.RuntimeError=e.ParsingError=void 0;var i=n(631),a=function(r){function e(e,n,t,o,i){void 0===o&&(o=t);var a=r.call(this,o,{cause:i})||this;return a.expression=e,a.index=n,a.reason=t,a}return o(e,r),e}(i.CustomError);e.ParsingError=a;var u=function(r){function e(e,n,t){var o=r.call(this,n,{cause:t})||this;return o.ast=e,o}return o(e,r),e}(i.CustomError);e.RuntimeError=u;var l=function(r){function e(e,n){return r.call(this,e,{cause:n})||this}return o(e,r),e}(i.CustomError);e.UnexpectedError=l},750:(r,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getEvaluator=void 0;var t=n(543),o=function(r){return{_tag:"some",isSome:!0,value:r}},i={_tag:"none",isSome:!1},a=function(r){return"some"===r._tag},u=function(r){return"none"===r._tag},l=function(r){return void 0===r?i:o(r)};e.getEvaluator=function(r,e){var n=[r],f=function(){if(n.length>0)return n[n.length-1];throw new t.UnexpectedError("Stack is empty")},c=function(r){return"this"===r?o(f()):"root"===r?o(n[0]):l(e[r])},s=function(r){return n.reduce((function(e,n){return a(e)?e:"this"===r?o(n):null!=n?l(n[r]):i}),i)},p=function(r){return function(e,n){var t=v(e),o=v(n);if("number"!=typeof t)throw new Error(JSON.stringify(t)+" is not a float");if("number"!=typeof o)throw new Error(JSON.stringify(o)+" is not a float");return r(t,o)}},h=function(r,e,t){var o=(t?r.reverse():r).find((function(r){n.push(r);var t=v(e);if(n.pop(),"boolean"!=typeof t)throw new Error("Result of selection expression is not Boolean");return!0===t}));return void 0===o?null:o},v=function(e){var t,o,i;switch(e.type){case"BooleanLiteral":case"NumberLiteral":case"StringLiteral":return e.value;case"CompoundExpression":var l=e.expressionComponents.reduce((function(r,e){var t=v(e);return n.push(t),t}),r);return e.expressionComponents.forEach((function(){n.pop()})),l;case"Elvis":var y=v(e.expression);return null===y?v(e.ifFalse):y;case"FunctionReference":var g=c(e.functionName),w=e.args.map(v);if(u(g)){if(e.nullSafeNavigation)return null;throw new Error("Method "+e.functionName+" not found.")}if("function"!=typeof(E=g.value))throw new Error("Variable "+e.functionName+" is not a function.");return E.apply(void 0,w);case"Indexer":if(null===(T=f())&&e.nullSafeNavigation)return null;var d=v(e.index);if("string"==typeof T&&"number"==typeof d){if(d>=0&&d<T.length)return T[d];throw new Error("index "+d+" is out of range on string "+JSON.stringify(T))}if(Array.isArray(T)&&"number"==typeof d){if(d>=0&&d<T.length)return T[d];throw new Error("index "+d+" is out of range on array "+JSON.stringify(T))}if(T&&"object"==typeof T&&("string"==typeof d||"number"==typeof d)){if(Object.prototype.hasOwnProperty.call(T,d))return T[d];throw new Error("key "+d+" not found in dictionary "+JSON.stringify(T))}throw new Error("Not supported: indexing into "+JSON.stringify(T)+" with "+JSON.stringify(d));case"InlineList":return e.elements.map(v);case"InlineMap":return Object.entries(e.elements).reduce((function(r,e){var n=e[0],t=e[1];return r[n]=v(t),r}),{});case"MethodReference":var O=s(e.methodName);if(a(O)){var E=O.value;if(w=e.args.map(v),"function"==typeof E)return E.apply(void 0,w)}else{var S=f();if(Array.isArray(S)){if("size"===e.methodName)return S.length;if("contains"===e.methodName)return S.includes(v(e.args[0]))}if(!e.nullSafeNavigation)throw new Error("Method "+e.methodName+" not found.")}return null;case"Negative":var m=v(e.value);if("number"==typeof m)return-1*m;throw new Error("unary (-) operator applied to "+JSON.stringify(m));case"NullLiteral":return null;case"OpAnd":var x=v(e.left),b=v(e.right);if(null!==x&&"boolean"!=typeof x)throw new Error(JSON.stringify(x)+" is not a null/boolean");if(null!==b&&"boolean"!=typeof b)throw new Error(JSON.stringify(b)+" is not a null/boolean");return x&&b;case"OpDivide":return p((function(r,e){return r/e}))(e.left,e.right);case"OpEQ":return(x=v(e.left))===v(e.right);case"OpGE":return p((function(r,e){return r>=e}))(e.left,e.right);case"OpGT":return p((function(r,e){return r>e}))(e.left,e.right);case"OpLE":return p((function(r,e){return r<=e}))(e.left,e.right);case"OpLT":return p((function(r,e){return r<e}))(e.left,e.right);case"OpMatches":return(i=function(r,e){return RegExp(e).test(r)},function(r,e){var n=v(r),t=v(e);if("string"!=typeof n)throw new Error(JSON.stringify(n)+" is not a string");if("string"!=typeof t)throw new Error(JSON.stringify(t)+" is not a string");return i(n,t)})(e.left,e.right);case"OpBetween":if(x=v(e.left),b=v(e.right),!Array.isArray(b)||2!==b.length)throw new Error("Right operand for the between operator has to be a two-element list");var N=b[0],P=b[1];return N<=x&&x<=P;case"OpMinus":return p((function(r,e){return r-e}))(e.left,e.right);case"OpModulus":return p((function(r,e){return r%e}))(e.left,e.right);case"OpMultiply":return p((function(r,e){return r*e}))(e.left,e.right);case"OpNE":return(x=v(e.left))!==v(e.right);case"OpNot":return!v(e.expression);case"OpOr":return x=v(e.left),b=v(e.right),Boolean(x||b);case"OpPlus":return p((function(r,e){return r+e}))(e.left,e.right);case"OpPower":return p((function(r,e){return Math.pow(r,e)}))(e.base,e.expression);case"Projection":var _=e.nullSafeNavigation,j=e.expression;if(null===(T=f())&&_)return null;if(Array.isArray(T))return T.map((function(r){n.push(r);var e=v(j);return n.pop(),e}));if(T&&"object"==typeof T)return Object.values(T).map((function(r){n.push(r);var e=v(j);return n.pop(),e}));throw new Error("Cannot run expression on non-array "+JSON.stringify(T));case"PropertyReference":_=e.nullSafeNavigation;var M=e.propertyName;if(O=s(M),u(O)){if(_)return null;throw new Error("Null Pointer Exception: Property "+JSON.stringify(M)+" not found in context "+JSON.stringify(n))}return O.value;case"SelectionAll":_=e.nullSafeNavigation;var A=e.expression;if(null===(T=f())&&_)return null;if(Array.isArray(T))return T.filter((function(r,e){n.push(r);var t=v(A);if(n.pop(),"boolean"!=typeof t)throw new Error("Result "+JSON.stringify(t)+" at index "+e+" of selection expression is not Boolean");return!0===t}));if(T&&"object"==typeof T)return Object.fromEntries(Object.entries(T).filter((function(r,e){var t=r[0],o=r[1];n.push({key:t,value:o});var i=v(A);if(n.pop(),"boolean"!=typeof i)throw new Error("Result "+JSON.stringify(i)+" at index "+e+" of selection expression is not Boolean");return!0===i})));throw new Error("Cannot run selection expression on non-collection "+JSON.stringify(T));case"SelectionFirst":_=e.nullSafeNavigation;var L=e.expression;if(null===(T=f())&&_)return null;if(Array.isArray(T))return h(T,L,!1);if(T&&"object"==typeof T){var J=h(Object.entries(T).map((function(r){return{key:r[0],value:r[1]}})),L,!1);return J&&((t={})[J.key]=J.value,t)}throw new Error("Cannot run selection expression on non-array "+JSON.stringify(T));case"SelectionLast":var T;if(_=e.nullSafeNavigation,L=e.expression,null===(T=f())&&_)return null;if(Array.isArray(T))return h(T,L,!0);if(T&&"object"==typeof T)return J=h(Object.entries(T).map((function(r){return{key:r[0],value:r[1]}})),L,!0),J&&((o={})[J.key]=J.value,o);throw new Error("Cannot run selection expression on non-array "+JSON.stringify(T));case"Ternary":L=e.expression;var C=e.ifTrue,R=e.ifFalse,z=v(L);if(!0===z)return v(C);if(!1===z||null===z)return v(R);throw new Error("Unexpected non boolean/null in Ternary conditional expression: "+JSON.stringify(z));case"VariableReference":var I=c(e.variableName);if(u(I))throw new Error("Null Pointer Exception: variable "+JSON.stringify(e.variableName)+" not found");return I.value}};return v}},304:function(r,e,n){var t=this&&this.__spreadArray||function(r,e,n){if(n||2===arguments.length)for(var t,o=0,i=e.length;o<i;o++)!t&&o in e||(t||(t=Array.prototype.slice.call(e,0,o)),t[o]=e[o]);return r.concat(t||Array.prototype.slice.call(e))},o=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0}),e.parse=void 0;var i=n(543),a=o(n(320));e.parse=function(r){var e=0,n=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e]},o={char:function(n){var t;return e<r.length&&(t=r.charAt(e++))===n?t:(t&&t!==n&&e--,null)},chars:function(r){for(var n=e,t=!0,i=0;t&&i<r.length;i++)t=Boolean(o.char(r[i]));return t?r:(e=n,null)},regExp:function(n){var t;return e<r.length&&(t=n.exec(r.substr(e)))&&0===t.index?(e+=t[0].length,t[0]):null},firstOf:function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];for(var t=e,o=r.length,i=0;i<o;i++){var a=r[i]();if(null!==a)return a;e=t}return null},zeroOrMore:function(r){for(;;){var n=e;if(!r())return e=n,!0}},whitSpc:function(){for(;e<r.length&&""===r.charAt(e).trim();)e+=1;return!0},identifier:function(){return o.regExp(/^([a-zA-Z_$][a-zA-Z0-9_$]*)/)},stringLiteral:function(){var n=(0,a.default)(r.slice(e));return n?(e+=n[1],n[0]):null}},u=function(){n("expression"),o.whitSpc();var t=l();if(o.whitSpc(),o.char("?")){if(o.char(":")){n("after elvis operator");var a=u();if(n("after expression eaten post elvis"),!a)throw new i.ParsingError(r,e,"Expected expression after elvis (?:)");return{type:"Elvis",expression:t,ifFalse:a}}a=null;var f=null;if((a=u())&&o.char(":")&&(f=u()))return{type:"Ternary",expression:t,ifTrue:a,ifFalse:f};throw new i.ParsingError(r,e,"Incomplete Ternary")}return t},l=function(){n("logicalOrExpression"),o.whitSpc();var r=f();return o.whitSpc(),o.zeroOrMore((function(){var e;return o.whitSpc(),o.char("|")&&o.char("|")&&(e=f())?r={type:"OpOr",left:r,right:e}:null})),r},f=function(){n("logicalAndExpression"),o.whitSpc();var r=c();return o.whitSpc(),o.zeroOrMore((function(){var e;return o.whitSpc(),o.char("&")&&o.char("&")&&(e=c())?r={type:"OpAnd",left:r,right:e}:null})),r},c=function(){n("relationalExpression"),o.whitSpc();var t=s(),a=null,u=e;if(o.whitSpc(),o.char(">")){if(o.char("=")){if(a=s())return{type:"OpGE",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for >=")}if(a=s())return{type:"OpGT",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for >")}if(o.char("<")){if(o.char("=")){if(a=s())return{type:"OpLE",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for <=")}if(a=s())return{type:"OpLT",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for <")}if(o.char("!")){if(o.char("=")){if(a=s())return{type:"OpNE",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for !=")}e=u}else{if(o.char("=")){if(n("got ="),o.char("=")){if(a=s())return{type:"OpEQ",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for ==")}throw new i.ParsingError(r,e,"Assignment not allowed")}var l=o.identifier();if("matches"===l){if(a=s())return{type:"OpMatches",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for 'matches'")}if("between"===l){if(a=s())return{type:"OpBetween",left:t,right:a};throw new i.ParsingError(r,e,"No right operand for 'between'")}if(l)throw new i.ParsingError(r,e,"Not an Operator",'"'.concat(l,'" is not an operator'))}return n("fell through"),t},s=function(){n("sumExpression"),o.whitSpc();var r=p();return o.whitSpc(),n("sumExpression left",r),o.zeroOrMore((function(){o.whitSpc(),n("in zeroOrMore");var e=null;return o.char("+")?(n("pluscase"),e=p(),r={type:"OpPlus",left:r,right:e}):o.char("-")?(n("minuscase"),e=p(),r={type:"OpMinus",left:r,right:e}):(n("missed all"),null)})),r},p=function(){n("productExpression"),o.whitSpc();var r=h();return o.whitSpc(),o.zeroOrMore((function(){var e=null;return o.char("*")?(e=h(),r={type:"OpMultiply",left:r,right:e}):o.char("/")?(e=h(),r={type:"OpDivide",left:r,right:e}):o.char("%")?(e=h(),r={type:"OpModulus",left:r,right:e}):null})),r},h=function(){n("powerExpression"),o.whitSpc();var r=v();o.whitSpc();var t=e;return o.char("^")?{type:"OpPower",base:r,expression:v()}:(e=t,r)},v=function(){return n("unaryExpression"),o.firstOf(y,g,w)},y=function(){n("negative");var r=null;return o.char("-")&&(r=v())?{type:"Negative",value:r}:(n("negative (null)"),null)},g=function(){n("not");var r=null;return o.char("!")&&(r=v())?{type:"OpNot",expression:r}:null},w=function(){n("primaryExpression"),o.whitSpc();var r=d();n("after startNode got");var e=[];return o.zeroOrMore((function(){var r;return(r=O())?(e.push(r),r):null})),e.length>0?{type:"CompoundExpression",expressionComponents:t([r],e,!0)}:r},d=function(){return n("startNode"),o.firstOf(M,j,N,(function(){return b(!1)}),A,L)},O=function(){return n("node"),o.firstOf(_,P,E,S,N)},E=function(){if(n("navProperty"),o.char("."))return b(!1);var r=e;return o.char("?")&&o.char(".")?b(!0):(e=r,null)},S=function(){return n("indexExp"),o.firstOf(m,x)},m=function(){n("nullSafeIndex");var r=e,t=null;return o.char("?")&&o.char("[")&&(t=u())&&o.char("]")?{type:"Indexer",nullSafeNavigation:!0,index:t}:(e=r,null)},x=function(){n("notNullSafeIndex");var r=e,t=null;return o.char("[")&&(t=u())&&o.char("]")?{type:"Indexer",nullSafeNavigation:!1,index:t}:(e=r,null)},b=function(r){n("methodOrProperty"),o.whitSpc();var t,i=[];if(t=o.identifier()){var a=e;return o.char("(")&&o.zeroOrMore((function(){var r=u();return r?(i.push(r),o.char(","),r):null}))&&o.char(")")?{type:"MethodReference",nullSafeNavigation:r,methodName:t,args:i}:(e=a,{type:"PropertyReference",propertyName:t,nullSafeNavigation:r})}return null},N=function(){n("functionOrVar"),o.whitSpc();var r=[],t=null;if(o.char("#")&&(t=o.identifier())){var i=e;return o.char("(")&&o.zeroOrMore((function(){var e=u();return e?(r.push(e),o.char(","),e):null}))&&o.char(")")?{type:"FunctionReference",nullSafeNavigation:!1,functionName:t,args:r}:(e=i,{type:"VariableReference",variableName:t})}return null},P=function(){n("selection"),o.whitSpc();var r=e,t=o.char("?")?!!o.char(".")||(e=r,null):!o.char(".")&&null;if(n("nullSafeNavigation "+t),null===t)return null;var i=o.firstOf((function(){var r;return o.char("?")&&o.char("[")&&o.whitSpc()&&(r=u())&&o.whitSpc()&&o.char("]")?{type:"SelectionAll",nullSafeNavigation:t,expression:r}:null}),(function(){var r;return o.char("^")&&o.char("[")&&(r=u())&&o.char("]")?{type:"SelectionFirst",nullSafeNavigation:t,expression:r}:null}),(function(){var r;return o.char("$")&&o.char("[")&&(r=u())&&o.char("]")?{type:"SelectionLast",nullSafeNavigation:t,expression:r}:null}));return null===i?(e=r,null):i},_=function(){n("projection"),o.whitSpc();var r,t=e,i=o.char("?")?!!o.char(".")||(e=t,null):!o.char(".")&&null;return null===i?null:o.char("!")&&o.char("[")&&(r=u())&&o.char("]")?{type:"Projection",nullSafeNavigation:i,expression:r}:(e=t,null)},j=function(){return n("literal"),o.firstOf((function(){var r=o.stringLiteral();return r?(n("returning stringLiteral",r),{type:"StringLiteral",value:r}):null}),J,(function(){return o.chars("true")&&{type:"BooleanLiteral",value:!0}}),(function(){return o.chars("false")&&{type:"BooleanLiteral",value:!1}}),(function(){return o.chars("null")&&{type:"NullLiteral"}}))},M=function(){var t;if(n("parenExpression"),o.char("(")){if((t=u())&&o.char(")"))return t;throw new i.ParsingError(r,e,"Unclosed Paren")}return null},A=function(){n("inlineList"),o.whitSpc();var r=[];if(o.char("{")){var t=e;if(o.zeroOrMore((function(){var e=u();return e?(r.push(e),o.char(","),o.whitSpc(),e):null}))&&o.char("}"))return{type:"InlineList",elements:r};e=t}return null},L=function(){n("inlineMap"),o.whitSpc();var r={};if(o.char("{")){var t=e;if(o.zeroOrMore((function(){var e,n;return o.whitSpc(),(e=o.identifier())&&o.char(":")&&(n=u())?(r[e]=n,o.char(","),n):null}))&&o.whitSpc()&&o.char("}"))return{type:"InlineMap",elements:r};e=t}return null},J=function(){o.whitSpc();var r=o.regExp(/\d+(?:\.\d+)?/);return r?{type:"NumberLiteral",value:parseFloat(r)}:null},T=u();if(r.trim().length-1>e)throw new i.ParsingError(r,e,"Expression Remaining");if(null===T)throw new i.ParsingError(r,e,"Generic");return T}},320:(r,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n={SINGLE_QUOTE:"'",DOUBLE_QUOTE:'"',TICK_QUOTE:"`"},t=function(r){return Object.values(n).includes(r)};e.default=function(r){var e=function(e,n){var o=e,i=r[o];if(n?n===i:t(i)){for(;r[++o]===i;);return{char:i,length:o-e,continueIx:o}}return null},n=function(){for(var e,n=0;""===(null===(e=r[n])||void 0===e?void 0:e.trim());)n+=1;return n}(),o=r[n],i=t(o)?o:null;if(i)for(var a=n+1;a<r.length;){var u=e(a,i);if(u){if(u.length%2!=0){var l=a+u.length;return[r.slice(n+1,l-1).split(i.repeat(2)).join(i),l]}a=u.continueIx+1}else a+=1}return null}},631:(r,e,n)=>{function t(r,e){void 0===e&&(e=r.constructor);var n=Error.captureStackTrace;n&&n(r,e)}n.r(e),n.d(e,{CustomError:()=>a,customErrorFactory:()=>l});var o,i=(o=function(r,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])},o(r,e)},function(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=r}o(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(r){function e(e,n){var o,i,a,u=this.constructor,l=r.call(this,e,n)||this;return Object.defineProperty(l,"name",{value:u.name,enumerable:!1,configurable:!0}),o=l,i=u.prototype,(a=Object.setPrototypeOf)?a(o,i):o.__proto__=i,t(l),l}return i(e,r),e}(Error),u=function(r,e,n){if(n||2===arguments.length)for(var t,o=0,i=e.length;o<i;o++)!t&&o in e||(t||(t=Array.prototype.slice.call(e,0,o)),t[o]=e[o]);return r.concat(t||Array.prototype.slice.call(e))};function l(r,e){function n(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];if(!(this instanceof n))return new(n.bind.apply(n,u([void 0],o,!1)));e.apply(this,o),Object.defineProperty(this,"name",{value:r.name||e.name,enumerable:!1,configurable:!0}),r.apply(this,o),t(this,n)}return void 0===e&&(e=Error),Object.defineProperties(n,{prototype:{value:Object.create(e.prototype,{constructor:{value:n,writable:!0,configurable:!0}})}})}}},e={};function n(t){var o=e[t];if(void 0!==o)return o.exports;var i=e[t]={exports:{}};return r[t].call(i.exports,i,i.exports,n),i.exports}n.d=(r,e)=>{for(var t in e)n.o(e,t)&&!n.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},n.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),n.r=r=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})};var t={};return(()=>{var r=t;Object.defineProperty(r,"__esModule",{value:!0}),r.getEvaluator=r.parse=void 0;var e=n(750);Object.defineProperty(r,"getEvaluator",{enumerable:!0,get:function(){return e.getEvaluator}});var o=n(304);Object.defineProperty(r,"parse",{enumerable:!0,get:function(){return o.parse}})})(),t})()));
//# sourceMappingURL=ts-spel.js.map